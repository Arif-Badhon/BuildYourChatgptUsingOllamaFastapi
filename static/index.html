<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Gemma3 Chat - Portfolio Demo</title>
  <style>
    body { font-family: monospace; background: #111; color: #eee; }
    #log { white-space: pre-wrap; border: 1px solid #444; padding: 10px; height: 400px; overflow-y: auto; margin-bottom: 10px; background: #222;}
    textarea { width: 100%; padding: 8px; margin-bottom: 10px; background: #222; color: #eee; border: 1px solid #555; }
    button { background: #0074D9; color: #fff; border: none; padding: 10px 18px; cursor: pointer; }
    button:disabled { background: #444; cursor: not-allowed; }
    #toolbar { margin-bottom: 10px; }
  </style>
</head>
<body>
  <h2>Gemma3 Chat Demo</h2>
  <div id="log"></div>
  <form id="chatform"><textarea id="input" rows="3" placeholder="Type your message..."></textarea><br>
    <button id="send" type="submit">Send</button>
  </form>
  <script>
    const log = document.getElementById('log');
    const input = document.getElementById('input');
    const form = document.getElementById('chatform');
    let history = [{role:"system", content:"You are a helpful assistant."}];

    function append(role, content) {
      log.textContent += `\n${role}: ${content}`;
      log.scrollTop = log.scrollHeight;
    }

    form.onsubmit = async (e) => {
      e.preventDefault();
      const userContent = input.value.trim();
      if (!userContent) return;
      append('You', userContent);
      history.push({role:"user", content:userContent});
      input.value = "";
      append('Assistant', '');
      let assistantText = '';
      form.send.disabled = true;

      const response = await fetch("/chat", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({
          model: "gemma3:1b",   // Set this to match your Ollama pull/tag
          messages: history,
          stream: true
        })
      });

      const reader = response.body.getReader();
      const decoder = new TextDecoder();
      while (true) {
        const {value, done} = await reader.read();
        if (done) break;
        const chunk = decoder.decode(value);
        assistantText += chunk;
        let logLines = log.textContent.split('\n');
        logLines[logLines.length-1] = `Assistant: ${assistantText}`;
        log.textContent = logLines.join('\n');
        log.scrollTop = log.scrollHeight;
      }
      history.push({role:"assistant", content:assistantText.trim()});
      form.send.disabled = false;
    };
  </script>
</body>
</html>
